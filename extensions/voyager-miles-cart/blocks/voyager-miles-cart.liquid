{% comment %} Include the CSS and JS files {% endcomment %}
{{ 'voyager-miles-cart.css' | asset_url | stylesheet_tag }}
<script src="{{ 'voyager-miles-cart.js' | asset_url }}" defer></script>

{% comment %}
  SAA Voyager Miles Cart Block
  This block integrates Voyager loyalty points into the cart page
{% endcomment %}

<div class="voyager-miles-cart-block" 
     data-voyager-api-url="{{ block.settings.voyager_api_url | default: 'https://saa-voyager-app-prod.tofmail2022.workers.dev/api/voyager' }}"
     data-points-rate="{{ block.settings.points_to_zar_rate | default: '0.1' }}"
     data-min-points="{{ block.settings.min_points_usage | default: 1000 }}"
     data-max-points="{{ block.settings.max_points_usage | default: 50000 }}">
  
  <!-- Header -->
  <div class="voyager-header" id="voyager-header-btn">
    <h2>PAY WITH SAA VOYAGER MILES</h2>
  </div>
  
  <!-- Navigation Tabs -->
  <div class="voyager-tabs">
    <div class="voyager-tab">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M11 4H4C3.44772 4 3 4.44772 3 5V19C3 19.5523 3.44772 20 4 20H20C20.5523 20 21 19.5523 21 19V12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        <path d="M18.5 2.5C18.8978 2.10218 19.4374 1.87868 20 1.87868C20.5626 1.87868 21.1022 2.10218 21.5 2.5C21.8978 2.89782 22.1213 3.43739 22.1213 4C22.1213 4.56261 21.8978 5.10218 21.5 5.5L12 15L8 16L9 12L18.5 2.5Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
      <span>Note</span>
    </div>
    <div class="voyager-tab">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M1 3H17L22 12V20H1V3Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        <path d="M22 12H17L13 8H1" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        <circle cx="5.5" cy="18.5" r="2.5" stroke="currentColor" stroke-width="2"/>
        <circle cx="18.5" cy="18.5" r="2.5" stroke="currentColor" stroke-width="2"/>
      </svg>
      <span>Shipping</span>
    </div>
    <div class="voyager-tab">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M20 7H4C2.89543 7 2 7.89543 2 9V15C2 16.1046 2.89543 17 4 17H20C21.1046 17 22 16.1046 22 15V9C22 7.89543 21.1046 7 20 7Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        <path d="M8 7V17M16 7V17" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        <path d="M12 10C12.5523 10 13 9.55228 13 9C13 8.44772 12.5523 8 12 8C11.4477 8 11 8.44772 11 9C11 9.55228 11.4477 10 12 10Z" fill="currentColor"/>
        <path d="M12 16C12.5523 16 13 15.5523 13 15C13 14.4477 12.5523 14 12 14C11.4477 14 11 14.4477 11 15C11 15.5523 11.4477 16 12 16Z" fill="currentColor"/>
      </svg>
      <span>Voucher</span>
    </div>
    <div class="voyager-tab active">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M2 12L12 6L22 12L12 18L2 12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        <path d="M12 6V18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        <path d="M2 12L22 12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
      </svg>
      <span>SAA Voyager</span>
    </div>
  </div>
  
  <div class="voyager-miles-section" id="voyager-miles-section" style="display: none;">
    <!-- Login Form -->
    <div class="voyager-login-form" id="voyager-login-form">
      <div class="voyager-login-header">
        <div class="voyager-title-with-icon">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M21 10C21 17 12 23 12 23C12 23 3 17 3 10C3 7.61305 3.94821 5.32387 5.63604 3.63604C7.32387 1.94821 9.61305 1 12 1C14.3869 1 16.6761 1.94821 18.364 3.63604C20.0518 5.32387 21 7.61305 21 10Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M12 13C13.6569 13 15 11.6569 15 10C15 8.34315 13.6569 7 12 7C10.3431 7 9 8.34315 9 10C9 11.6569 10.3431 13 12 13Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <h3>SAA Voyager Miles</h3>
        </div>
        <p class="voyager-instruction">Log in securely to view your balance and apply Miles to this purchase</p>
      </div>
      
      <div class="voyager-input-group">
        <label for="voyager-username">Voyager Number</label>
        <input type="text" id="voyager-username" name="username" placeholder="Enter your Voyager number" required>
      </div>
      
      <div class="voyager-input-group">
        <label for="voyager-password">Pin</label>
        <input type="password" id="voyager-password" name="password" placeholder="Enter your PIN" required>
      </div>
      
      <div class="voyager-button-group">
        <button type="button" class="voyager-cancel-btn" id="voyager-cancel-btn">CANCEL</button>
        <button type="submit" class="voyager-login-btn" id="voyager-login-btn">
          LOGIN & CHECK MILES
        </button>
      </div>
      
      <p class="voyager-disclaimer">*If you'd like to pay for your full order and delivery using Voyager Miles, you can do so on the final payment page.</p>
      
      <div id="voyager-status" class="voyager-status"></div>
    </div>
    
    <!-- Points Display -->
    <div class="voyager-points-display" id="voyager-points-display" style="display: none;">
      <div class="voyager-points-header">
        <div class="voyager-title-with-icon">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M21 10C21 17 12 23 12 23C12 23 3 17 3 10C3 7.61305 3.94821 5.32387 5.63604 3.63604C7.32387 1.94821 9.61305 1 12 1C14.3869 1 16.6761 1.94821 18.364 3.63604C20.0518 5.32387 21 7.61305 21 10Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M12 13C13.6569 13 15 11.6569 15 10C15 8.34315 13.6569 7 12 7C10.3431 7 9 8.34315 9 10C9 11.6569 10.3431 13 12 13Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <h3>SAA Voyager Miles</h3>
        </div>
        <button type="button" class="voyager-logout-btn" id="voyager-logout-btn" title="Logout">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M9 21H5C4.46957 21 3.96086 20.7893 3.58579 20.4142C3.21071 20.0391 3 19.5304 3 19V5C3 4.46957 3.21071 3.96086 3.58579 3.58579C3.96086 3.21071 4.46957 3 5 3H9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M16 17L21 12L16 7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M21 12H9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <span>LOGOUT</span>
        </button>
      </div>
      
      <div class="voyager-points-info">
        <div class="points-row">
          <span class="points-label">Available Miles:</span>
          <span class="points-value orange" id="points-value">Loading...</span>
        </div>
        
        <div class="points-row">
          <span class="points-label">Value in ZAR:</span>
          <span class="points-value orange" id="zar-value">Calculating...</span>
        </div>
        
        <div class="points-row">
          <span class="points-label">Cart Total:</span>
          <span class="points-value orange" id="cart-total">R 0.00</span>
        </div>
        
        <div class="points-row total-after">
          <span class="points-label">Total after applied Miles:</span>
          <span class="points-value orange large" id="total-after-miles">R 0.00</span>
        </div>
      </div>
      
      <div class="points-usage">
        <div class="zar-input-container">
          <label for="zar-to-use" class="zar-input-label">Enter the Rand amount you would like to redeem</label>
          <div class="zar-input-wrapper">
            <input type="number" id="zar-to-use" min="0" step="0.01" placeholder="R 100" value="100">
            <span id="zar-to-points-display" class="zar-points-display"></span>
          </div>
        </div>
        
        <div class="voyager-button-group">
          <button type="button" class="voyager-cancel-btn" id="voyager-cancel-points-btn">CANCEL</button>
          <button id="apply-points" class="apply-points-btn" disabled>
            APPLY MILES
          </button>
        </div>
      </div>
      
      <p class="voyager-disclaimer">*If you'd like to pay for your full order and delivery using Voyager Miles, you can do so on the final payment page.</p>
      
      <div id="points-status" class="points-status"></div>
    </div>
  </div>
</div>

{% schema %}
{
  "name": "SAA Voyager Miles",
  "target": "section",
  "settings": [
    {
      "type": "text",
      "id": "voyager_api_url",
      "label": "Voyager API URL",
      "default": "https://saa-voyager-app-prod.tofmail2022.workers.dev/api/voyager",
      "info": "Backend API endpoint for Voyager services"
    },
    {
      "type": "text",
      "id": "points_to_zar_rate",
      "label": "Points to ZAR Rate",
      "default": "0.1",
      "info": "Conversion rate (1 point = R0.01)"
    },
    {
      "type": "number",
      "id": "min_points_usage",
      "label": "Minimum Points Usage",
      "default": 1000,
      "info": "Minimum points that can be used"
    },
    {
      "type": "number",
      "id": "max_points_usage",
      "label": "Maximum Points Usage",
      "default": 50000,
      "info": "Maximum points that can be used"
    }
  ]
}
{% endschema %}
