{% comment %} Include the CSS and JS files {% endcomment %}
{{ 'voyager-miles-cart.css' | asset_url | stylesheet_tag }}
<script src="{{ 'voyager-miles-cart.js' | asset_url }}" defer></script>

{% comment %}
  SAA Voyager Miles Cart Block
  This block integrates Voyager loyalty points into the cart page
{% endcomment %}

<div class="voyager-miles-cart-block" 
     data-voyager-api-url="{{ block.settings.voyager_api_url | default: 'https://saa-voyager-app-prod.tofmail2022.workers.dev/api/voyager' }}"
     data-points-rate="{{ block.settings.points_to_zar_rate | default: '0.1' }}"
     data-min-points="{{ block.settings.min_points_usage | default: 1000 }}"
     data-max-points="{{ block.settings.max_points_usage | default: 50000 }}">
  
  <!-- Header -->
  <div class="voyager-header" id="voyager-header-btn">
    <h2>PAY WITH SAA VOYAGER MILES</h2>
  </div>
  
  <!-- Navigation Tabs -->
  <div class="voyager-tabs">
    <div class="voyager-tab">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M11 4H4C3.44772 4 3 4.44772 3 5V19C3 19.5523 3.44772 20 4 20H20C20.5523 20 21 19.5523 21 19V12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        <path d="M18.5 2.5C18.8978 2.10218 19.4374 1.87868 20 1.87868C20.5626 1.87868 21.1022 2.10218 21.5 2.5C21.8978 2.89782 22.1213 3.43739 22.1213 4C22.1213 4.56261 21.8978 5.10218 21.5 5.5L12 15L8 16L9 12L18.5 2.5Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
      <span>Note</span>
    </div>
    <div class="voyager-tab">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M1 3H17L22 12V20H1V3Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        <path d="M22 12H17L13 8H1" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        <circle cx="5.5" cy="18.5" r="2.5" stroke="currentColor" stroke-width="2"/>
        <circle cx="18.5" cy="18.5" r="2.5" stroke="currentColor" stroke-width="2"/>
      </svg>
      <span>Shipping</span>
    </div>
    <div class="voyager-tab">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M20 7H4C2.89543 7 2 7.89543 2 9V15C2 16.1046 2.89543 17 4 17H20C21.1046 17 22 16.1046 22 15V9C22 7.89543 21.1046 7 20 7Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        <path d="M8 7V17M16 7V17" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        <path d="M12 10C12.5523 10 13 9.55228 13 9C13 8.44772 12.5523 8 12 8C11.4477 8 11 8.44772 11 9C11 9.55228 11.4477 10 12 10Z" fill="currentColor"/>
        <path d="M12 16C12.5523 16 13 15.5523 13 15C13 14.4477 12.5523 14 12 14C11.4477 14 11 14.4477 11 15C11 15.5523 11.4477 16 12 16Z" fill="currentColor"/>
      </svg>
      <span>Voucher</span>
    </div>
    <div class="voyager-tab active">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 860 606">
<g>
<path d="M 392.28 565.03 C387.96,564.00 384.64,561.72 381.70,557.77 C375.64,549.60 375.62,542.81 381.54,508.67 C392.14,447.61 412.82,335.83 414.66,329.60 C415.16,327.94 414.84,327.78 412.07,328.34 C410.34,328.68 393.30,335.46 374.21,343.40 C293.67,376.90 250.20,391.26 207.29,398.56 C180.62,403.10 138.60,403.59 126.50,399.50 C112.93,394.92 100.06,386.25 94.46,377.92 C89.38,370.37 53.26,290.02 36.42,248.81 C30.24,233.69 29.80,232.11 30.28,226.83 C31.29,215.73 38.47,206.65 51.00,200.63 C57.36,197.57 57.81,197.50 72.00,197.50 C84.87,197.50 87.04,197.75 91.31,199.72 C97.49,202.57 112.40,212.84 137.50,231.53 C161.27,249.23 175.13,258.74 178.30,259.54 C179.59,259.86 182.82,259.25 185.56,258.17 C200.64,252.21 306.13,205.47 309.97,203.04 C310.78,202.53 311.23,201.93 310.97,201.70 C307.57,198.76 270.84,175.82 241.02,158.01 C227.78,150.10 207.86,137.61 199.39,131.92 C186.27,123.08 182.03,116.98 182.06,107.00 C182.09,100.75 184.03,96.46 188.50,92.76 C193.70,88.47 207.12,81.22 217.69,77.00 C231.12,71.65 244.99,70.13 264.61,71.86 C279.74,73.20 288.49,75.57 372.50,101.05 C463.40,128.61 468.48,130.11 471.00,130.17 C473.56,130.24 493.43,121.68 580.00,83.24 C630.43,60.86 655.01,50.58 665.19,47.63 C705.68,35.90 754.84,38.89 787.25,55.06 C810.78,66.81 829.00,86.20 829.00,99.50 C829.00,104.73 824.45,114.17 818.96,120.36 C800.50,141.13 734.88,177.83 609.72,237.37 L 598.95 242.50 L 563.64 319.00 C544.21,361.08 526.85,398.65 525.05,402.50 C523.26,406.35 517.84,418.05 513.01,428.50 C497.53,462.03 481.07,496.19 474.86,507.65 C468.15,520.04 459.21,531.82 450.08,540.27 C440.63,549.01 420.12,559.74 404.66,564.03 C396.95,566.16 397.03,566.16 392.28,565.03 ZM 418.84 523.75 C428.73,518.87 443.60,501.14 450.92,485.50 C492.07,397.59 502.29,375.60 563.85,242.64 C569.92,229.51 575.03,218.66 575.20,218.51 C575.36,218.36 588.10,212.23 603.50,204.89 C702.99,157.42 764.40,124.19 789.85,104.03 L 795.20 99.79 L 791.56 96.06 C784.47,88.80 764.40,78.69 750.82,75.54 C741.64,73.41 717.03,71.66 706.00,72.36 C695.97,72.99 674.51,77.94 662.93,82.30 C659.31,83.66 649.41,87.81 640.93,91.51 C626.97,97.61 561.25,126.64 551.50,131.01 C530.04,140.64 302.15,241.78 271.00,255.49 C190.16,291.08 187.89,292.00 180.73,291.99 C167.52,291.98 159.16,287.34 119.83,258.21 C91.54,237.25 81.05,230.14 76.64,228.92 C72.72,227.85 65.43,228.49 64.50,230.00 C63.01,232.41 103.16,324.55 118.29,353.47 C123.23,362.90 123.81,363.58 128.98,366.17 C137.36,370.36 145.17,371.32 166.06,370.75 C187.39,370.17 203.91,367.59 231.32,360.56 C278.55,348.45 323.62,331.29 420.50,288.54 C437.55,281.02 452.74,274.61 454.25,274.31 C456.82,273.79 456.97,273.94 456.49,276.62 C455.87,280.15 450.06,312.01 445.47,337.00 C443.61,347.17 440.74,362.70 439.09,371.50 C437.44,380.30 435.60,390.20 434.99,393.50 C434.38,396.80 432.14,408.73 430.00,420.00 C427.86,431.27 425.62,443.20 425.01,446.50 C424.40,449.80 422.56,459.70 420.91,468.50 C414.87,500.83 411.01,522.54 411.00,524.25 C411.00,526.60 413.36,526.45 418.84,523.75 ZM 366.70 178.11 C385.48,169.93 415.92,156.12 421.40,153.31 C425.89,151.00 425.83,150.94 416.50,148.05 C356.79,129.53 293.43,110.51 276.50,106.01 C266.38,103.32 248.75,102.32 239.61,103.91 C232.65,105.12 225.00,107.71 225.00,108.86 C225.02,111.09 346.01,185.00 349.65,185.00 C350.34,185.00 358.02,181.90 366.70,178.11 Z" fill="rgba(0,0,0,1)"/>
</g>
</svg>
      <span>SAA Voyager</span>
    </div>
  </div>
  
  <div class="voyager-miles-section" id="voyager-miles-section" style="display: none;">
    <!-- Login Form -->
    <div class="voyager-login-form" id="voyager-login-form">
      <div class="voyager-login-header">
        <div class="voyager-title-with-icon">
          <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 860 606">
          <g>
          <path d="M 392.28 565.03 C387.96,564.00 384.64,561.72 381.70,557.77 C375.64,549.60 375.62,542.81 381.54,508.67 C392.14,447.61 412.82,335.83 414.66,329.60 C415.16,327.94 414.84,327.78 412.07,328.34 C410.34,328.68 393.30,335.46 374.21,343.40 C293.67,376.90 250.20,391.26 207.29,398.56 C180.62,403.10 138.60,403.59 126.50,399.50 C112.93,394.92 100.06,386.25 94.46,377.92 C89.38,370.37 53.26,290.02 36.42,248.81 C30.24,233.69 29.80,232.11 30.28,226.83 C31.29,215.73 38.47,206.65 51.00,200.63 C57.36,197.57 57.81,197.50 72.00,197.50 C84.87,197.50 87.04,197.75 91.31,199.72 C97.49,202.57 112.40,212.84 137.50,231.53 C161.27,249.23 175.13,258.74 178.30,259.54 C179.59,259.86 182.82,259.25 185.56,258.17 C200.64,252.21 306.13,205.47 309.97,203.04 C310.78,202.53 311.23,201.93 310.97,201.70 C307.57,198.76 270.84,175.82 241.02,158.01 C227.78,150.10 207.86,137.61 199.39,131.92 C186.27,123.08 182.03,116.98 182.06,107.00 C182.09,100.75 184.03,96.46 188.50,92.76 C193.70,88.47 207.12,81.22 217.69,77.00 C231.12,71.65 244.99,70.13 264.61,71.86 C279.74,73.20 288.49,75.57 372.50,101.05 C463.40,128.61 468.48,130.11 471.00,130.17 C473.56,130.24 493.43,121.68 580.00,83.24 C630.43,60.86 655.01,50.58 665.19,47.63 C705.68,35.90 754.84,38.89 787.25,55.06 C810.78,66.81 829.00,86.20 829.00,99.50 C829.00,104.73 824.45,114.17 818.96,120.36 C800.50,141.13 734.88,177.83 609.72,237.37 L 598.95 242.50 L 563.64 319.00 C544.21,361.08 526.85,398.65 525.05,402.50 C523.26,406.35 517.84,418.05 513.01,428.50 C497.53,462.03 481.07,496.19 474.86,507.65 C468.15,520.04 459.21,531.82 450.08,540.27 C440.63,549.01 420.12,559.74 404.66,564.03 C396.95,566.16 397.03,566.16 392.28,565.03 ZM 418.84 523.75 C428.73,518.87 443.60,501.14 450.92,485.50 C492.07,397.59 502.29,375.60 563.85,242.64 C569.92,229.51 575.03,218.66 575.20,218.51 C575.36,218.36 588.10,212.23 603.50,204.89 C702.99,157.42 764.40,124.19 789.85,104.03 L 795.20 99.79 L 791.56 96.06 C784.47,88.80 764.40,78.69 750.82,75.54 C741.64,73.41 717.03,71.66 706.00,72.36 C695.97,72.99 674.51,77.94 662.93,82.30 C659.31,83.66 649.41,87.81 640.93,91.51 C626.97,97.61 561.25,126.64 551.50,131.01 C530.04,140.64 302.15,241.78 271.00,255.49 C190.16,291.08 187.89,292.00 180.73,291.99 C167.52,291.98 159.16,287.34 119.83,258.21 C91.54,237.25 81.05,230.14 76.64,228.92 C72.72,227.85 65.43,228.49 64.50,230.00 C63.01,232.41 103.16,324.55 118.29,353.47 C123.23,362.90 123.81,363.58 128.98,366.17 C137.36,370.36 145.17,371.32 166.06,370.75 C187.39,370.17 203.91,367.59 231.32,360.56 C278.55,348.45 323.62,331.29 420.50,288.54 C437.55,281.02 452.74,274.61 454.25,274.31 C456.82,273.79 456.97,273.94 456.49,276.62 C455.87,280.15 450.06,312.01 445.47,337.00 C443.61,347.17 440.74,362.70 439.09,371.50 C437.44,380.30 435.60,390.20 434.99,393.50 C434.38,396.80 432.14,408.73 430.00,420.00 C427.86,431.27 425.62,443.20 425.01,446.50 C424.40,449.80 422.56,459.70 420.91,468.50 C414.87,500.83 411.01,522.54 411.00,524.25 C411.00,526.60 413.36,526.45 418.84,523.75 ZM 366.70 178.11 C385.48,169.93 415.92,156.12 421.40,153.31 C425.89,151.00 425.83,150.94 416.50,148.05 C356.79,129.53 293.43,110.51 276.50,106.01 C266.38,103.32 248.75,102.32 239.61,103.91 C232.65,105.12 225.00,107.71 225.00,108.86 C225.02,111.09 346.01,185.00 349.65,185.00 C350.34,185.00 358.02,181.90 366.70,178.11 Z" fill="rgba(0,0,0,1)"/>
          </g>
          </svg>
          <h3>SAA Voyager Miles</h3>
        </div>
        <p class="voyager-instruction">Log in securely to view your balance and apply Miles to this purchase</p>
      </div>
      
      <div class="voyager-input-group">
        <label for="voyager-username">Voyager Number</label>
        <input type="text" id="voyager-username" name="username" placeholder="Enter your Voyager number" required>
      </div>
      
      <div class="voyager-input-group">
        <label for="voyager-password">Pin</label>
        <input type="password" id="voyager-password" name="password" placeholder="Enter your PIN" required>
      </div>
      
      <div class="voyager-button-group">
        <button type="button" class="voyager-cancel-btn" id="voyager-cancel-btn">CANCEL</button>
        <button type="submit" class="voyager-login-btn" id="voyager-login-btn">
          LOGIN & CHECK MILES
        </button>
      </div>
      
      <p class="voyager-disclaimer">*If you'd like to pay for your full order and delivery using Voyager Miles, you can do so on the final payment page.</p>
      
      <div id="voyager-status" class="voyager-status"></div>
    </div>
    
    <!-- Points Display -->
    <div class="voyager-points-display" id="voyager-points-display" style="display: none;">
      <div class="voyager-points-header">
        <div class="voyager-title-with-icon">
          <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 860 606">
          <g>
          <path d="M 392.28 565.03 C387.96,564.00 384.64,561.72 381.70,557.77 C375.64,549.60 375.62,542.81 381.54,508.67 C392.14,447.61 412.82,335.83 414.66,329.60 C415.16,327.94 414.84,327.78 412.07,328.34 C410.34,328.68 393.30,335.46 374.21,343.40 C293.67,376.90 250.20,391.26 207.29,398.56 C180.62,403.10 138.60,403.59 126.50,399.50 C112.93,394.92 100.06,386.25 94.46,377.92 C89.38,370.37 53.26,290.02 36.42,248.81 C30.24,233.69 29.80,232.11 30.28,226.83 C31.29,215.73 38.47,206.65 51.00,200.63 C57.36,197.57 57.81,197.50 72.00,197.50 C84.87,197.50 87.04,197.75 91.31,199.72 C97.49,202.57 112.40,212.84 137.50,231.53 C161.27,249.23 175.13,258.74 178.30,259.54 C179.59,259.86 182.82,259.25 185.56,258.17 C200.64,252.21 306.13,205.47 309.97,203.04 C310.78,202.53 311.23,201.93 310.97,201.70 C307.57,198.76 270.84,175.82 241.02,158.01 C227.78,150.10 207.86,137.61 199.39,131.92 C186.27,123.08 182.03,116.98 182.06,107.00 C182.09,100.75 184.03,96.46 188.50,92.76 C193.70,88.47 207.12,81.22 217.69,77.00 C231.12,71.65 244.99,70.13 264.61,71.86 C279.74,73.20 288.49,75.57 372.50,101.05 C463.40,128.61 468.48,130.11 471.00,130.17 C473.56,130.24 493.43,121.68 580.00,83.24 C630.43,60.86 655.01,50.58 665.19,47.63 C705.68,35.90 754.84,38.89 787.25,55.06 C810.78,66.81 829.00,86.20 829.00,99.50 C829.00,104.73 824.45,114.17 818.96,120.36 C800.50,141.13 734.88,177.83 609.72,237.37 L 598.95 242.50 L 563.64 319.00 C544.21,361.08 526.85,398.65 525.05,402.50 C523.26,406.35 517.84,418.05 513.01,428.50 C497.53,462.03 481.07,496.19 474.86,507.65 C468.15,520.04 459.21,531.82 450.08,540.27 C440.63,549.01 420.12,559.74 404.66,564.03 C396.95,566.16 397.03,566.16 392.28,565.03 ZM 418.84 523.75 C428.73,518.87 443.60,501.14 450.92,485.50 C492.07,397.59 502.29,375.60 563.85,242.64 C569.92,229.51 575.03,218.66 575.20,218.51 C575.36,218.36 588.10,212.23 603.50,204.89 C702.99,157.42 764.40,124.19 789.85,104.03 L 795.20 99.79 L 791.56 96.06 C784.47,88.80 764.40,78.69 750.82,75.54 C741.64,73.41 717.03,71.66 706.00,72.36 C695.97,72.99 674.51,77.94 662.93,82.30 C659.31,83.66 649.41,87.81 640.93,91.51 C626.97,97.61 561.25,126.64 551.50,131.01 C530.04,140.64 302.15,241.78 271.00,255.49 C190.16,291.08 187.89,292.00 180.73,291.99 C167.52,291.98 159.16,287.34 119.83,258.21 C91.54,237.25 81.05,230.14 76.64,228.92 C72.72,227.85 65.43,228.49 64.50,230.00 C63.01,232.41 103.16,324.55 118.29,353.47 C123.23,362.90 123.81,363.58 128.98,366.17 C137.36,370.36 145.17,371.32 166.06,370.75 C187.39,370.17 203.91,367.59 231.32,360.56 C278.55,348.45 323.62,331.29 420.50,288.54 C437.55,281.02 452.74,274.61 454.25,274.31 C456.82,273.79 456.97,273.94 456.49,276.62 C455.87,280.15 450.06,312.01 445.47,337.00 C443.61,347.17 440.74,362.70 439.09,371.50 C437.44,380.30 435.60,390.20 434.99,393.50 C434.38,396.80 432.14,408.73 430.00,420.00 C427.86,431.27 425.62,443.20 425.01,446.50 C424.40,449.80 422.56,459.70 420.91,468.50 C414.87,500.83 411.01,522.54 411.00,524.25 C411.00,526.60 413.36,526.45 418.84,523.75 ZM 366.70 178.11 C385.48,169.93 415.92,156.12 421.40,153.31 C425.89,151.00 425.83,150.94 416.50,148.05 C356.79,129.53 293.43,110.51 276.50,106.01 C266.38,103.32 248.75,102.32 239.61,103.91 C232.65,105.12 225.00,107.71 225.00,108.86 C225.02,111.09 346.01,185.00 349.65,185.00 C350.34,185.00 358.02,181.90 366.70,178.11 Z" fill="rgba(0,0,0,1)"/>
          </g>
          </svg>
          <h3>SAA Voyager Miles</h3>
        </div>
        <button type="button" class="voyager-logout-btn" id="voyager-logout-btn" title="Logout">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M9 21H5C4.46957 21 3.96086 20.7893 3.58579 20.4142C3.21071 20.0391 3 19.5304 3 19V5C3 4.46957 3.21071 3.96086 3.58579 3.58579C3.96086 3.21071 4.46957 3 5 3H9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M16 17L21 12L16 7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M21 12H9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <span>LOGOUT</span>
        </button>
      </div>
      
      <div class="voyager-points-info">
        <div class="points-row">
          <span class="points-label">Available Miles:</span>
          <span class="points-value orange" id="points-value">Loading...</span>
        </div>
        
        <div class="points-row">
          <span class="points-label">Value in ZAR:</span>
          <span class="points-value orange" id="zar-value">Calculating...</span>
        </div>
        
        <div class="points-row">
          <span class="points-label">Cart Total:</span>
          <span class="points-value orange" id="cart-total">R 0.00</span>
        </div>
        
        <div class="points-row total-after">
          <span class="points-label">Total after applied Miles:</span>
          <span class="points-value orange" id="total-after-miles">R 0.00</span>
        </div>
      </div>
      
      <div class="points-usage">
        <div class="zar-input-container">
          <label for="zar-to-use" class="zar-input-label orange">Enter the Rand amount you would like to redeem</label>
          <div class="zar-input-wrapper">
            <input type="number" id="zar-to-use" min="0" step="0.01" placeholder="R 0" value="0">
            <span id="zar-to-points-display" class="zar-points-display"></span>
          </div>
        </div>
        
        <div class="voyager-button-group">
          <button type="button" class="voyager-cancel-btn" id="voyager-cancel-points-btn">CANCEL</button>
          <button id="apply-points" class="apply-points-btn" disabled>
            APPLY MILES
          </button>
        </div>
      </div>
      
      <p class="voyager-disclaimer">*If you'd like to pay for your full order and delivery using Voyager Miles, you can do so on the final payment page.</p>
      
      <div id="points-status" class="points-status"></div>
    </div>
  </div>
</div>

{% schema %}
{
  "name": "SAA Voyager Miles",
  "target": "section",
  "settings": [
    {
      "type": "text",
      "id": "voyager_api_url",
      "label": "Voyager API URL",
      "default": "https://saa-voyager-app-prod.tofmail2022.workers.dev/api/voyager",
      "info": "Backend API endpoint for Voyager services"
    },
    {
      "type": "text",
      "id": "points_to_zar_rate",
      "label": "Points to ZAR Rate",
      "default": "0.1",
      "info": "Conversion rate (1 point = R0.01)"
    },
    {
      "type": "number",
      "id": "min_points_usage",
      "label": "Minimum Points Usage",
      "default": 1000,
      "info": "Minimum points that can be used"
    },
    {
      "type": "number",
      "id": "max_points_usage",
      "label": "Maximum Points Usage",
      "default": 50000,
      "info": "Maximum points that can be used"
    }
  ]
}
{% endschema %}
